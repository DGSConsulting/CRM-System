<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Favicon -->
  <link rel="icon" type="image/png" href="images/logo-icon-t.png" />
    <title> CRM System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #9CAF88 0%, #6B8E5A 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 5px;
            backdrop-filter: blur(10px);
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            border-radius: 10px;
            margin: 0 5px;
            transition: all 0.3s ease;
            font-size: 16px;
            font-weight: 500;
        }

        .nav-tab.active {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .tab-content {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-section {
            background: linear-gradient(135deg, #9CAF88 0%, #9CAF88 100%);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 5px solid #4A5D23;
        }

        .form-section h3 {
            color: #ffffff;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #ffffff;
        }

        .form-group input, 
        .form-group select, 
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ffffff;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }

        .btn {
            background: linear-gradient(135deg, #9CAF88 0%, #6B8E5A 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #fd79a8 0%, #e84393 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #55efc4 0%, #00b894 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #fdcb6e 0%, #e17055 100%);
        }

        .contacts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .contact-card {
            background: linear-gradient(135deg, #9CAF88 0%, #6B8E5A 100%);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-left: 5px solid #4A5D23;
            position: relative;
            transition: all 0.3s ease;
        }

        .contact-card:hover {
            transform: translateY(-5px);
        }

        .contact-card h4 {
            color: #ffffff;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .contact-info {
            color: #ffffff;
            margin-bottom: 8px;
        }

        .contact-info strong {
            color: #ffffff;
            margin-right: 8px;
            min-width: 80px;
        }

        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #9CAF88 0%, #6B8E5A 100%);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            color: white;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1rem;
            opacity: 0.9;
        }

        .search-bar {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 16px;
            margin-bottom: 20px;
            background: rgba(255,255,255,0.9);
        }

        .filters-container {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-group select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
        }

        .notes-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border-left: 4px solid #9CAF88;
        }

        .note-item {
            background: white;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 3px solid #6B8E5A;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .note-meta {
            font-size: 0.8em;
            color: #666;
            margin-bottom: 5px;
        }

        .task-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #9CAF88;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .task-item.completed {
            opacity: 0.7;
            border-left-color: #00b894;
        }

        .task-content {
            flex: 1;
        }

        .task-actions {
            display: flex;
            gap: 10px;
        }

        .priority-high { border-left-color: #e74c3c !important; }
        .priority-medium { border-left-color: #f39c12 !important; }
        .priority-low { border-left-color: #2ecc71 !important; }

        .export-import-section {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #9CAF88 0%, #6B8E5A 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 1001;
            display: none;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        /* DARK MODE STYLES */
        body.dark-mode {
            background: linear-gradient(135deg, #1e1e2f 0%, #2c2c3e 100%);
            color: #f5f5f5;
        }

        body.dark-mode .tab-content {
            background: #2c2c3e;
            color: #fff;
            border-color: #444;
        }

        body.dark-mode .contact-card {
            background: #3a3a4e;
            color: #fff;
            border-left-color: #764ba2;
        }

        body.dark-mode .stat-card {
            background: #3a3a4e;
            color: #fff;
        }

        body.dark-mode .search-bar {
            background: #2c2c3e;
            color: #fff;
            border-color: #555;
        }

        body.dark-mode .form-group input,
        body.dark-mode .form-group select,
        body.dark-mode .form-group textarea {
            background: #2c2c3e;
            color: #fff;
            border-color: #555;
        }

        body.dark-mode .modal-content {
            background: #2c2c3e;
            color: #fff;
        }

        body.dark-mode .task-item,
        body.dark-mode .note-item {
            background: #3a3a4e;
            color: #fff;
        }

        body.dark-mode .notes-section {
            background: #3a3a4e;
        }

        @media (max-width: 768px) {
            .nav-tabs {
                flex-direction: column;
                gap: 5px;
            }
            
            .nav-tab {
                margin: 2px 0;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .contacts-grid {
                grid-template-columns: 1fr;
            }
            
            .export-import-section {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀  CRM System</h1>
            <p>Manage your contacts, tasks, and leads efficiently</p>
            <button onclick="toggleDarkMode()" class="btn btn-secondary" style="margin-top: 15px;">
                🌙 Toggle Dark Mode
            </button>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('dashboard')">📊 Dashboard</button>
            <button class="nav-tab" onclick="showTab('contacts')">👥 Contacts</button>
            <button class="nav-tab" onclick="showTab('add-contact')">➕ Add Contact</button>
            <button class="nav-tab" onclick="showTab('tasks')">📋 Tasks</button>
            <button class="nav-tab" onclick="showTab('analytics')">📈 Analytics</button>
            <button class="nav-tab" onclick="showTab('import-export')">💾 Data</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="dashboard-stats">
                <div class="stat-card">
                    <div class="stat-number" id="total-contacts">0</div>
                    <div class="stat-label">Total Contacts</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-leads">0</div>
                    <div class="stat-label">Active Leads</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-customers">0</div>
                    <div class="stat-label">Customers</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-tasks">0</div>
                    <div class="stat-label">Pending Tasks</div>
                </div>
            </div>
            
            <div class="form-section">
                <h3>📊 Recent Activity</h3>
                <div id="recent-activity"></div>
            </div>
        </div>

        <!-- Contacts Tab -->
        <div id="contacts" class="tab-content">
            <input type="text" class="search-bar" id="search-contacts" placeholder="🔍 Search contacts..." oninput="filterContacts()">
            
            <div class="filters-container">
                <div class="filter-group">
                    <label>Status Filter:</label>
                    <select id="status-filter" onchange="filterContacts()">
                        <option value="">All Statuses</option>
                        <option value="lead">Lead</option>
                        <option value="prospect">Prospect</option>
                        <option value="customer">Customer</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Sort By:</label>
                    <select id="sort-contacts" onchange="sortContacts()">
                        <option value="name">Name</option>
                        <option value="company">Company</option>
                        <option value="date">Date Added</option>
                        <option value="status">Status</option>
                    </select>
                </div>
                <button class="btn btn-secondary" onclick="exportContacts()">📤 Export CSV</button>
            </div>
            
            <div class="contacts-grid" id="contacts-grid"></div>
        </div>

        <!-- Add Contact Tab -->
        <div id="add-contact" class="tab-content">
            <div class="form-section">
                <h3>👤 Contact Information</h3>
                <form id="contact-form">
                    <div class="form-grid">
                        <div>
                            <div class="form-group">
                                <label for="firstName">First Name *</label>
                                <input type="text" id="firstName" required>
                            </div>
                            <div class="form-group">
                                <label for="lastName">Last Name *</label>
                                <input type="text" id="lastName" required>
                            </div>
                            <div class="form-group">
                                <label for="email">Email *</label>
                                <input type="email" id="email" required>
                            </div>
                            <div class="form-group">
                                <label for="phone">Phone</label>
                                <input type="tel" id="phone">
                            </div>
                        </div>
                        <div>
                            <div class="form-group">
                                <label for="company">Company</label>
                                <input type="text" id="company">
                            </div>
                            <div class="form-group">
                                <label for="position">Position</label>
                                <input type="text" id="position">
                            </div>
                            <div class="form-group">
                                <label for="status">Status *</label>
                                <select id="status" required>
                                    <option value="lead">Lead</option>
                                    <option value="prospect">Prospect</option>
                                    <option value="customer">Customer</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="source">Lead Source</label>
                                <select id="source">
                                    <option value="">Select Source</option>
                                    <option value="website">Website</option>
                                    <option value="referral">Referral</option>
                                    <option value="social-media">Social Media</option>
                                    <option value="advertisement">Advertisement</option>
                                    <option value="event">Event</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="notes">Notes</label>
                        <textarea id="notes" rows="3" placeholder="Add notes about this contact..."></textarea>
                    </div>
                    <button type="submit" class="btn">💾 Save Contact</button>
                    <button type="reset" class="btn btn-secondary">🔄 Reset Form</button>
                </form>
            </div>
        </div>

        <!-- Tasks Tab -->
        <div id="tasks" class="tab-content">
            <div class="form-section">
                <h3>➕ Add New Task</h3>
                <form id="task-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="task-title">Task Title *</label>
                            <input type="text" id="task-title" required>
                        </div>
                        <div class="form-group">
                            <label for="task-contact">Related Contact</label>
                            <select id="task-contact">
                                <option value="">Select Contact</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="task-priority">Priority</label>
                            <select id="task-priority">
                                <option value="low">Low</option>
                                <option value="medium" selected>Medium</option>
                                <option value="high">High</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="task-due">Due Date</label>
                            <input type="date" id="task-due">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="task-description">Description</label>
                        <textarea id="task-description" rows="3"></textarea>
                    </div>
                    <button type="submit" class="btn">➕ Add Task</button>
                </form>
            </div>

            <div class="filters-container">
                <div class="filter-group">
                    <label>Filter Tasks:</label>
                    <select id="task-filter" onchange="filterTasks()">
                        <option value="all">All Tasks</option>
                        <option value="pending">Pending</option>
                        <option value="completed">Completed</option>
                        <option value="overdue">Overdue</option>
                    </select>
                </div>
            </div>

            <div id="tasks-list"></div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics" class="tab-content">
            <div class="dashboard-stats">
                <div class="stat-card">
                    <div class="stat-number" id="conversion-rate">0%</div>
                    <div class="stat-label">Lead Conversion Rate</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="avg-deal-value">$0</div>
                    <div class="stat-label">Avg. Deal Value</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="active-opportunities">0</div>
                    <div class="stat-label">Active Opportunities</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="monthly-growth">0%</div>
                    <div class="stat-label">Monthly Growth</div>
                </div>
            </div>

            <div class="form-section">
                <h3>📈 Contact Distribution by Status</h3>
                <div id="status-chart"></div>
            </div>

            <div class="form-section">
                <h3>📊 Lead Sources</h3>
                <div id="source-chart"></div>
            </div>
        </div>

        <!-- Import/Export Tab -->
        <div id="import-export" class="tab-content">
            <div class="form-section">
                <h3>📤 Export Data</h3>
                <div class="export-import-section">
                    <button class="btn" onclick="exportContacts()">📧 Export Contacts (CSV)</button>
                    <button class="btn btn-secondary" onclick="exportTasks()">📋 Export Tasks (CSV)</button>
                    <button class="btn btn-success" onclick="exportAll()">💾 Export All Data (JSON)</button>
                </div>
            </div>

            <div class="form-section">
                <h3>📥 Import Data</h3>
                <div class="form-group">
                    <label for="import-file">Select File (CSV or JSON)</label>
                    <input type="file" id="import-file" accept=".csv,.json" onchange="handleFileImport(event)">
                </div>
                <button class="btn btn-warning" onclick="clearAllData()">🗑️ Clear All Data</button>
            </div>

            <div class="form-section">
                <h3>🔄 Backup & Restore</h3>
                <p>Last backup: <span id="last-backup">Never</span></p>
                <div class="export-import-section">
                    <button class="btn" onclick="createBackup()">💾 Create Backup</button>
                    <button class="btn btn-secondary" onclick="restoreBackup()">🔄 Restore Backup</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Contact Details Modal -->
    <div id="contact-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <div id="modal-content"></div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <script>
        let contacts = [];
        let tasks = [];
        let editingContactId = null;
        let editingTaskId = null;

        // Load data on page load
        function loadData() {
            const savedContacts = localStorage.getItem('crmContacts');
            const savedTasks = localStorage.getItem('crmTasks');
            
            if (savedContacts) {
                contacts = JSON.parse(savedContacts);
            }
            if (savedTasks) {
                tasks = JSON.parse(savedTasks);
            }
            
            const darkModeSetting = localStorage.getItem('crmDarkMode');
            if (darkModeSetting === 'enabled') {
                document.body.classList.add('dark-mode');
            }
            
            updateDashboard();
            displayContacts();
            displayTasks();
            updateTaskContactOptions();
            updateAnalytics();
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('crmContacts', JSON.stringify(contacts));
            localStorage.setItem('crmTasks', JSON.stringify(tasks));
        }

        // Tab navigation
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'analytics') {
                setTimeout(updateAnalytics, 100); // Delay to ensure tab is visible
            }
        }

        // Contact form submission
        document.getElementById('contact-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!validateEmail(document.getElementById('email').value)) {
                showNotification('Please enter a valid email address! ❌', 'error');
                return;
            }
            
            const newContact = {
                firstName: document.getElementById('firstName').value.trim(),
                lastName: document.getElementById('lastName').value.trim(),
                email: document.getElementById('email').value.trim().toLowerCase(),
                phone: document.getElementById('phone').value.trim(),
                company: document.getElementById('company').value.trim(),
                position: document.getElementById('position').value.trim(),
                status: document.getElementById('status').value,
                source: document.getElementById('source').value,
                notes: document.getElementById('notes').value.trim(),
                dateAdded: new Date().toISOString().split('T')[0],
                lastModified: new Date().toISOString()
            };

            // Check for duplicate email
            const existingContact = contacts.find(c => c.email === newContact.email && c.id !== editingContactId);
            if (existingContact) {
                showNotification('A contact with this email already exists! ❌', 'error');
                return;
            }

            if (editingContactId) {
                const index = contacts.findIndex(c => c.id === editingContactId);
                if (index !== -1) {
                    contacts[index] = { ...contacts[index], ...newContact, id: editingContactId };
                }
                showNotification('Contact updated successfully! ✏️', 'success');
                editingContactId = null;
                document.querySelector('#contact-form button[type="submit"]').textContent = "💾 Save Contact";
            } else {
                newContact.id = Date.now();
                contacts.push(newContact);
                showNotification('Contact added successfully! 🎉', 'success');
            }

            saveData();
            updateDashboard();
            displayContacts();
            updateTaskContactOptions();
            this.reset();
            showTab('contacts');
        });

        // Task form submission
        document.getElementById('task-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newTask = {
                id: editingTaskId || Date.now(),
                title: document.getElementById('task-title').value.trim(),
                description: document.getElementById('task-description').value.trim(),
                contactId: document.getElementById('task-contact').value,
                priority: document.getElementById('task-priority').value,
                dueDate: document.getElementById('task-due').value,
                status: 'pending',
                dateCreated: new Date().toISOString(),
                dateCompleted: null
            };

            if (editingTaskId) {
                const index = tasks.findIndex(t => t.id === editingTaskId);
                if (index !== -1) {
                    tasks[index] = { ...tasks[index], ...newTask };
                }
                showNotification('Task updated successfully! ✏️', 'success');
                editingTaskId = null;
            } else {
                tasks.push(newTask);
                showNotification('Task added successfully! 🎉', 'success');
            }

            saveData();
            updateDashboard();
            displayTasks();
            this.reset();
        });

        // Display contacts
        function displayContacts() {
            const contactsGrid = document.getElementById('contacts-grid');
            if (contacts.length === 0) {
                contactsGrid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 40px;">
                        <h3>No contacts yet</h3>
                        <p>Add your first contact to get started!</p>
                    </div>
                `;
                return;
            }
            
            let filteredContacts = filterAndSortContacts();
            
            contactsGrid.innerHTML = filteredContacts.map(contact => `
                <div class="contact-card">
                    <h4>${contact.firstName} ${contact.lastName}</h4>
                    <div class="contact-info"><strong>📧</strong> ${contact.email}</div>
                    ${contact.phone ? `<div class="contact-info"><strong>📱</strong> ${contact.phone}</div>` : ''}
                    ${contact.company ? `<div class="contact-info"><strong>🏢</strong> ${contact.company}</div>` : ''}
                    ${contact.position ? `<div class="contact-info"><strong>💼</strong> ${contact.position}</div>` : ''}
                    <div class="contact-info"><strong>🎯</strong> ${contact.status.charAt(0).toUpperCase() + contact.status.slice(1)}</div>
                    ${contact.source ? `<div class="contact-info"><strong>📍</strong> ${contact.source.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())}</div>` : ''}
                    <div style="margin-top:15px;">
                        <button class="btn btn-secondary" onclick="viewContact(${contact.id})" style="padding: 8px 16px; font-size: 14px;">👁️ View</button>
                        <button class="btn btn-secondary" onclick="editContact(${contact.id})" style="padding: 8px 16px; font-size: 14px;">✏️ Edit</button>
                        <button class="btn btn-danger" onclick="deleteContact(${contact.id})" style="padding: 8px 16px; font-size: 14px;">🗑️ Delete</button>
                    </div>
                </div>
            `).join('');
        }

        // Display tasks
        function displayTasks() {
            const tasksList = document.getElementById('tasks-list');
            let filteredTasks = getFilteredTasks();
            
            if (filteredTasks.length === 0) {
                tasksList.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <h3>No tasks found</h3>
                        <p>Add your first task to get started!</p>
                    </div>
                `;
                return;
            }

            tasksList.innerHTML = filteredTasks.map(task => {
                const contact = contacts.find(c => c.id == task.contactId);
                const isOverdue = task.dueDate && new Date(task.dueDate) < new Date() && task.status === 'pending';
                
                return `
                    <div class="task-item priority-${task.priority} ${task.status === 'completed' ? 'completed' : ''} ${isOverdue ? 'overdue' : ''}">
                        <div class="task-content">
                            <h4>${task.title}</h4>
                            ${task.description ? `<p>${task.description}</p>` : ''}
                            ${contact ? `<div><strong>Contact:</strong> ${contact.firstName} ${contact.lastName}</div>` : ''}
                            ${task.dueDate ? `<div><strong>Due:</strong> ${formatDate(task.dueDate)} ${isOverdue ? '⚠️' : ''}</div>` : ''}
                            <div><strong>Priority:</strong> ${task.priority.toUpperCase()}</div>
                        </div>
                        <div class="task-actions">
                            ${task.status === 'pending' ? 
                                `<button class="btn btn-success" onclick="completeTask(${task.id})">✅ Complete</button>` : 
                                `<button class="btn btn-warning" onclick="reopenTask(${task.id})">🔄 Reopen</button>`
                            }
                            <button class="btn btn-secondary" onclick="editTask(${task.id})">✏️ Edit</button>
                            <button class="btn btn-danger" onclick="deleteTask(${task.id})">🗑️ Delete</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // View contact details in modal
        function viewContact(id) {
            const contact = contacts.find(c => c.id === id);
            if (!contact) return;

            const contactTasks = tasks.filter(t => t.contactId == id);
            
            document.getElementById('modal-content').innerHTML = `
                <h2>${contact.firstName} ${contact.lastName}</h2>
                <div style="margin: 20px 0;">
                    <div class="contact-info"><strong>📧 Email:</strong> ${contact.email}</div>
                    ${contact.phone ? `<div class="contact-info"><strong>📱 Phone:</strong> ${contact.phone}</div>` : ''}
                    ${contact.company ? `<div class="contact-info"><strong>🏢 Company:</strong> ${contact.company}</div>` : ''}
                    ${contact.position ? `<div class="contact-info"><strong>💼 Position:</strong> ${contact.position}</div>` : ''}
                    <div class="contact-info"><strong>🎯 Status:</strong> ${contact.status.charAt(0).toUpperCase() + contact.status.slice(1)}</div>
                    ${contact.source ? `<div class="contact-info"><strong>📍 Source:</strong> ${contact.source.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())}</div>` : ''}
                    <div class="contact-info"><strong>📅 Date Added:</strong> ${formatDate(contact.dateAdded)}</div>
                </div>
                
                ${contact.notes ? `
                    <div class="notes-section">
                        <h4>📝 Notes</h4>
                        <p>${contact.notes}</p>
                    </div>
                ` : ''}
                
                ${contactTasks.length > 0 ? `
                    <div class="notes-section">
                        <h4>📋 Related Tasks (${contactTasks.length})</h4>
                        ${contactTasks.map(task => `
                            <div class="note-item">
                                <div class="note-meta">${task.status.toUpperCase()} - ${task.priority.toUpperCase()} Priority</div>
                                <strong>${task.title}</strong>
                                ${task.description ? `<p>${task.description}</p>` : ''}
                                ${task.dueDate ? `<div><strong>Due:</strong> ${formatDate(task.dueDate)}</div>` : ''}
                            </div>
                        `).join('')}
                    </div>
                ` : ''}
                
                <div style="margin-top: 20px;">
                    <button class="btn" onclick="addNote(${id})">📝 Add Note</button>
                    <button class="btn btn-secondary" onclick="editContact(${id}); closeModal()">✏️ Edit Contact</button>
                    <button class="btn btn-success" onclick="createTaskFromContact(${id}); closeModal()">➕ Create Task</button>
                </div>
            `;
            
            document.getElementById('contact-modal').style.display = 'block';
        }

        // Close modal
        function closeModal() {
            document.getElementById('contact-modal').style.display = 'none';
        }

        // Edit contact
        function editContact(id) {
            const contact = contacts.find(c => c.id === id);
            if (!contact) return;

            document.getElementById('firstName').value = contact.firstName || '';
            document.getElementById('lastName').value = contact.lastName || '';
            document.getElementById('email').value = contact.email || '';
            document.getElementById('phone').value = contact.phone || '';
            document.getElementById('company').value = contact.company || '';
            document.getElementById('position').value = contact.position || '';
            document.getElementById('status').value = contact.status || 'lead';
            document.getElementById('source').value = contact.source || '';
            document.getElementById('notes').value = contact.notes || '';

            editingContactId = id;
            document.querySelector('#contact-form button[type="submit"]').textContent = "💾 Update Contact";
            showTab('add-contact');
        }

        // Delete contact
        function deleteContact(id) {
            if (confirm('Are you sure you want to delete this contact? This will also delete all related tasks.')) {
                contacts = contacts.filter(contact => contact.id !== id);
                tasks = tasks.filter(task => task.contactId != id);
                saveData();
                updateDashboard();
                displayContacts();
                displayTasks();
                showNotification('Contact and related tasks deleted successfully! 🗑️', 'success');
            }
        }

        // Edit task
        function editTask(id) {
            const task = tasks.find(t => t.id === id);
            if (!task) return;

            document.getElementById('task-title').value = task.title;
            document.getElementById('task-description').value = task.description || '';
            document.getElementById('task-contact').value = task.contactId || '';
            document.getElementById('task-priority').value = task.priority;
            document.getElementById('task-due').value = task.dueDate || '';

            editingTaskId = id;
            showTab('tasks');
        }

        // Complete task
        function completeTask(id) {
            const task = tasks.find(t => t.id === id);
            if (task) {
                task.status = 'completed';
                task.dateCompleted = new Date().toISOString();
                saveData();
                updateDashboard();
                displayTasks();
                showNotification('Task completed! ✅', 'success');
            }
        }

        // Reopen task
        function reopenTask(id) {
            const task = tasks.find(t => t.id === id);
            if (task) {
                task.status = 'pending';
                task.dateCompleted = null;
                saveData();
                updateDashboard();
                displayTasks();
                showNotification('Task reopened! 🔄', 'success');
            }
        }

        // Delete task
        function deleteTask(id) {
            if (confirm('Are you sure you want to delete this task?')) {
                tasks = tasks.filter(task => task.id !== id);
                saveData();
                updateDashboard();
                displayTasks();
                showNotification('Task deleted successfully! 🗑️', 'success');
            }
        }

        // Create task from contact
        function createTaskFromContact(contactId) {
            document.getElementById('task-contact').value = contactId;
            showTab('tasks');
            document.getElementById('task-title').focus();
        }

        // Filter and sort contacts
        function filterAndSortContacts() {
            let filtered = [...contacts];
            
            // Search filter
            const searchTerm = document.getElementById('search-contacts').value.toLowerCase();
            if (searchTerm) {
                filtered = filtered.filter(contact =>
                    contact.firstName.toLowerCase().includes(searchTerm) ||
                    contact.lastName.toLowerCase().includes(searchTerm) ||
                    contact.email.toLowerCase().includes(searchTerm) ||
                    (contact.company && contact.company.toLowerCase().includes(searchTerm)) ||
                    (contact.position && contact.position.toLowerCase().includes(searchTerm))
                );
            }
            
            // Status filter
            const statusFilter = document.getElementById('status-filter').value;
            if (statusFilter) {
                filtered = filtered.filter(contact => contact.status === statusFilter);
            }
            
            // Sort
            const sortBy = document.getElementById('sort-contacts').value;
            filtered.sort((a, b) => {
                switch (sortBy) {
                    case 'name':
                        return `${a.firstName} ${a.lastName}`.localeCompare(`${b.firstName} ${b.lastName}`);
                    case 'company':
                        return (a.company || '').localeCompare(b.company || '');
                    case 'date':
                        return new Date(b.dateAdded) - new Date(a.dateAdded);
                    case 'status':
                        return a.status.localeCompare(b.status);
                    default:
                        return 0;
                }
            });
            
            return filtered;
        }

        // Filter contacts
        function filterContacts() {
            displayContacts();
        }

        // Sort contacts
        function sortContacts() {
            displayContacts();
        }

        // Get filtered tasks
        function getFilteredTasks() {
            const filter = document.getElementById('task-filter').value;
            let filtered = [...tasks];
            
            switch (filter) {
                case 'pending':
                    filtered = filtered.filter(t => t.status === 'pending');
                    break;
                case 'completed':
                    filtered = filtered.filter(t => t.status === 'completed');
                    break;
                case 'overdue':
                    filtered = filtered.filter(t => 
                        t.status === 'pending' && 
                        t.dueDate && 
                        new Date(t.dueDate) < new Date()
                    );
                    break;
            }
            
            // Sort by due date and priority
            filtered.sort((a, b) => {
                if (a.dueDate && b.dueDate) {
                    return new Date(a.dueDate) - new Date(b.dueDate);
                }
                if (a.dueDate) return -1;
                if (b.dueDate) return 1;
                
                const priorityOrder = { high: 3, medium: 2, low: 1 };
                return priorityOrder[b.priority] - priorityOrder[a.priority];
            });
            
            return filtered;
        }

        // Filter tasks
        function filterTasks() {
            displayTasks();
        }

        // Update dashboard
        function updateDashboard() {
            document.getElementById('total-contacts').textContent = contacts.length;
            document.getElementById('total-leads').textContent = contacts.filter(c => c.status === 'lead').length;
            document.getElementById('total-customers').textContent = contacts.filter(c => c.status === 'customer').length;
            document.getElementById('total-tasks').textContent = tasks.filter(t => t.status === 'pending').length;
            
            // Update recent activity
            updateRecentActivity();
        }

        // Update recent activity
        function updateRecentActivity() {
            const recentContacts = contacts
                .sort((a, b) => new Date(b.lastModified || b.dateAdded) - new Date(a.lastModified || a.dateAdded))
                .slice(0, 5);
                
            const recentTasks = tasks
                .sort((a, b) => new Date(b.dateCreated) - new Date(a.dateCreated))
                .slice(0, 5);

            const activity = document.getElementById('recent-activity');
            activity.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <h4>Recent Contacts</h4>
                        ${recentContacts.map(contact => `
                            <div class="note-item">
                                <strong>${contact.firstName} ${contact.lastName}</strong>
                                <div class="note-meta">${contact.company || ''} - ${formatDate(contact.dateAdded)}</div>
                            </div>
                        `).join('')}
                    </div>
                    <div>
                        <h4>Recent Tasks</h4>
                        ${recentTasks.map(task => `
                            <div class="note-item">
                                <strong>${task.title}</strong>
                                <div class="note-meta">${task.status.toUpperCase()} - ${formatDate(task.dateCreated.split('T')[0])}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // Update task contact options
        function updateTaskContactOptions() {
            const select = document.getElementById('task-contact');
            select.innerHTML = '<option value="">Select Contact</option>' +
                contacts.map(contact => 
                    `<option value="${contact.id}">${contact.firstName} ${contact.lastName} - ${contact.company || contact.email}</option>`
                ).join('');
        }

        // Update analytics
        function updateAnalytics() {
            const totalLeads = contacts.filter(c => c.status === 'lead').length;
            const totalCustomers = contacts.filter(c => c.status === 'customer').length;
            const conversionRate = totalLeads > 0 ? Math.round((totalCustomers / (totalLeads + totalCustomers)) * 100) : 0;
            
            document.getElementById('conversion-rate').textContent = `${conversionRate}%`;
            document.getElementById('avg-deal-value').textContent = '$2,500'; // Placeholder
            document.getElementById('active-opportunities').textContent = contacts.filter(c => c.status === 'prospect').length;
            document.getElementById('monthly-growth').textContent = '12%'; // Placeholder
            
            // Status distribution
            const statusCounts = {
                lead: contacts.filter(c => c.status === 'lead').length,
                prospect: contacts.filter(c => c.status === 'prospect').length,
                customer: contacts.filter(c => c.status === 'customer').length
            };
            
            document.getElementById('status-chart').innerHTML = `
                <div style="display: flex; gap: 20px; justify-content: center;">
                    ${Object.entries(statusCounts).map(([status, count]) => `
                        <div style="text-align: center;">
                            <div style="width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #9CAF88, #6B8E5A); display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; font-weight: bold; margin: 0 auto 10px;">${count}</div>
                            <div style="font-weight: bold; text-transform: capitalize;">${status}</div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            // Source distribution
            const sourceCounts = {};
            contacts.forEach(c => {
                if (c.source) {
                    sourceCounts[c.source] = (sourceCounts[c.source] || 0) + 1;
                }
            });
            
            document.getElementById('source-chart').innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                    ${Object.entries(sourceCounts).map(([source, count]) => `
                        <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                            <div style="font-size: 24px; font-weight: bold; color: #9CAF88;">${count}</div>
                            <div style="text-transform: capitalize;">${source.replace('-', ' ')}</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Export functions
        function exportContacts() {
            if (contacts.length === 0) {
                showNotification('No contacts to export! ❌', 'error');
                return;
            }
            
            const csv = convertToCSV(contacts);
            downloadCSV(csv, 'contacts.csv');
            showNotification('Contacts exported successfully! 📤', 'success');
        }

        function exportTasks() {
            if (tasks.length === 0) {
                showNotification('No tasks to export! ❌', 'error');
                return;
            }
            
            const tasksWithContactNames = tasks.map(task => {
                const contact = contacts.find(c => c.id == task.contactId);
                return {
                    ...task,
                    contactName: contact ? `${contact.firstName} ${contact.lastName}` : 'No Contact'
                };
            });
            
            const csv = convertToCSV(tasksWithContactNames);
            downloadCSV(csv, 'tasks.csv');
            showNotification('Tasks exported successfully! 📤', 'success');
        }

        function exportAll() {
            const data = {
                contacts: contacts,
                tasks: tasks,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `crm-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('Full backup exported successfully! 💾', 'success');
        }

        // Import function
        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    if (file.name.endsWith('.json')) {
                        const data = JSON.parse(e.target.result);
                        if (data.contacts) contacts = data.contacts;
                        if (data.tasks) tasks = data.tasks;
                    } else if (file.name.endsWith('.csv')) {
                        // Simple CSV import for contacts
                        const lines = e.target.result.split('\n');
                        const headers = lines[0].split(',').map(h => h.trim());
                        
                        for (let i = 1; i < lines.length; i++) {
                            if (lines[i].trim()) {
                                const values = lines[i].split(',').map(v => v.trim());
                                const contact = {
                                    id: Date.now() + i,
                                    dateAdded: new Date().toISOString().split('T')[0],
                                    lastModified: new Date().toISOString()
                                };
                                
                                headers.forEach((header, index) => {
                                    if (values[index]) {
                                        contact[header.toLowerCase().replace(/\s+/g, '')] = values[index];
                                    }
                                });
                                
                                if (contact.email) {
                                    contacts.push(contact);
                                }
                            }
                        }
                    }
                    
                    saveData();
                    updateDashboard();
                    displayContacts();
                    displayTasks();
                    updateTaskContactOptions();
                    showNotification('Data imported successfully! 📥', 'success');
                } catch (error) {
                    showNotification('Error importing file! Please check the format. ❌', 'error');
                }
            };
            reader.readAsText(file);
        }

        // Backup functions
        function createBackup() {
            exportAll();
            localStorage.setItem('crmLastBackup', new Date().toISOString());
            updateLastBackupDisplay();
        }

        function restoreBackup() {
            document.getElementById('import-file').click();
        }

        function updateLastBackupDisplay() {
            const lastBackup = localStorage.getItem('crmLastBackup');
            if (lastBackup) {
                document.getElementById('last-backup').textContent = formatDate(lastBackup.split('T')[0]);
            }
        }

        function clearAllData() {
            if (confirm('Are you sure you want to delete ALL data? This cannot be undone!')) {
                if (confirm('This will permanently delete all contacts and tasks. Are you absolutely sure?')) {
                    contacts = [];
                    tasks = [];
                    saveData();
                    updateDashboard();
                    displayContacts();
                    displayTasks();
                    updateTaskContactOptions();
                    showNotification('All data cleared! 🗑️', 'success');
                }
            }
        }

        // Utility functions
        function convertToCSV(data) {
            if (data.length === 0) return '';
            
            const headers = Object.keys(data[0]);
            const csvRows = [headers.join(',')];
            
            for (const row of data) {
                const values = headers.map(header => {
                    const value = row[header];
                    return typeof value === 'string' && value.includes(',') ? `"${value}"` : value || '';
                });
                csvRows.push(values.join(','));
            }
            
            return csvRows.join('\n');
        }

        function downloadCSV(csv, filename) {
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString();
        }

        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        function toggleDarkMode() {
            const isDark = document.body.classList.toggle('dark-mode');
            localStorage.setItem('crmDarkMode', isDark ? 'enabled' : 'disabled');
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            
            if (type === 'error') {
                notification.style.background = 'linear-gradient(135deg, #fd79a8 0%, #e84393 100%)';
            } else if (type === 'success') {
                notification.style.background = 'linear-gradient(135deg, #55efc4 0%, #00b894 100%)';
            } else {
                notification.style.background = 'linear-gradient(135deg, #9CAF88 0%, #6B8E5A 100%)';
            }
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // Initialize app
        loadData();
        updateLastBackupDisplay();

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('contact-modal');
            if (event.target === modal) {
                closeModal();
            }
        }
    </script>

    <footer style="
      background: linear-gradient(90deg, #9CAF88 0%, #6B8E5A 50%, #4A5D23 100%);
      color:#fff;
      text-align:center;
      padding:20px;
      margin-top:50px;
      font-size:14px;
    "><div>
      <img src="images/logo-icon-t.png" alt="DGS Logo" class="h-6 mb-3">
      <p class="text-sm">&copy; 2025 DGS Consulting.— Streamline Today, Scale Tomorrow All rights reserved.</p>
    </div>
      <p>
        <a href="mailto:DGSConsult@consultant.com" style="color:#fff; text-decoration:none; margin:0 8px;">Contact</a> |
        <a href="https://www.linkedin.com/company/dgs-consutling/" target="_blank" style="color:#fff; text-decoration:none; margin:0 8px;">LinkedIn</a> |
        <a href="https://www.instagram.com/dgsconsult/" target="_blank" style="color:#fff; text-decoration:none; margin:0 8px;">Instagram</a>
      </p>
    </footer>
</body>
</html>

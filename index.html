// Analytics and Reporting Functions
        function updateAnalytics() {
            const totalLeads = contacts.filter(c => c.status === 'lead').length;
            const totalCustomers = contacts.filter(c => c.status === 'customer').length;
            const conversionRate = totalLeads > 0 ? Math.round((totalCustomers / (totalLeads + totalCustomers)) * 100) : 0;
            
            const activeDealValues = deals.filter(d => !['closed-won', 'closed-lost'].includes(d.stage)).map(d => d.value);
            const avgDealValue = activeDealValues.length > 0 ? Math.round(activeDealValues.reduce((sum, val) => sum + val, 0) / activeDealValues.length) : 0;
            
            document.getElementById('conversion-rate').textContent = `${conversionRate}%`;
            document.getElementById('avg-deal-value').textContent = `${avgDealValue.toLocaleString()}`;
            document.getElementById('active-opportunities').textContent = deals.filter(d => !['closed-won', 'closed-lost'].includes(d.stage)).length;
            document.getElementById('monthly-growth').textContent = '12%';
            
            // Status distribution chart
            const statusCounts = {
                lead: contacts.filter(c => c.status === 'lead').length,
                prospect: contacts.filter(c => c.status === 'prospect').length,
                customer: contacts.filter(c => c.status === 'customer').length
            };
            
            document.getElementById('status-chart').innerHTML = `
                <div style="display: flex; gap: 20px; justify-content: center;">
                    ${Object.entries(statusCounts).map(([status, count]) => `
                        <div style="text-align: center;">
                            <div style="width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #9CAF88, #6B8E5A); display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; font-weight: bold; margin: 0 auto 10px;">${count}</div>
                            <div style="font-weight: bold; text-transform: capitalize;">${status}</div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            // Source distribution
            const sourceCounts = {};
            contacts.forEach(c => {
                if (c.source) {
                    sourceCounts[c.source] = (sourceCounts[c.source] || 0) + 1;
                }
            });
            
            document.getElementById('source-chart').innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                    ${Object.entries(sourceCounts).map(([source, count]) => `
                        <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                            <div style="font-size: 24px; font-weight: bold; color: #9CAF88;">${count}</div>
                            <div style="text-transform: capitalize;">${source.replace('-', ' ')}</div>
                        </div>
                    `).join('')}
                </div>
            `;

            // Deal pipeline
            const pipelineCounts = {};
            deals.filter(d => !['closed-won', 'closed-lost'].includes(d.stage)).forEach(d => {
                pipelineCounts[d.stage] = (pipelineCounts[d.stage] || 0) + 1;
            });

            document.getElementById('pipeline-chart').innerHTML = `
                <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                    ${Object.entries(pipelineCounts).map(([stage, count]) => `
                        <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 10px; min-width: 120px;">
                            <div style="font-size: 24px; font-weight: bold;">${count}</div>
                            <div style="text-transform: capitalize;">${stage.replace('-', ' ')}</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function updateReports() {
            // Activity report
            const thisMonth = new Date().getMonth();
            const thisYear = new Date().getFullYear();
            const monthlyContacts = contacts.filter(c => {
                const addedDate = new Date(c.dateAdded);
                return addedDate.getMonth() === thisMonth && addedDate.getFullYear() === thisYear;
            }).length;

            document.getElementById('activity-report').innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                        <h4>Contacts Added This Month</h4>
                        <div style="font-size: 36px; color: #9CAF88; font-weight: bold;">${monthlyContacts}</div>
                    </div>
                    <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                        <h4>Active Deals</h4>
                        <div style="font-size: 36px; color: #9CAF88; font-weight: bold;">${deals.filter(d => !['closed-won', 'closed-lost'].includes(d.stage)).length}</div>
                    </div>
                </div>
            `;

            // Sales trend chart
            const salesData = [
                { month: 'Jan', sales: 15000 },
                { month: 'Feb', sales: 22000 },
                { month: 'Mar', sales: 18000 },
                { month: 'Apr', sales: 35000 },
                { month: 'May', sales: 28000 },
                { month: 'Jun', sales: 42000 }
            ];

            document.getElementById('sales-trend-chart').innerHTML = `
                <div style="display: flex; align-items: end; gap: 10px; height: 200px; padding: 20px;">
                    ${salesData.map(data => `
                        <div style="flex: 1; text-align: center;">
                            <div style="background: linear-gradient(135deg, #9CAF88, #6B8E5A); width: 100%; height: ${data.sales / 500}px; border-radius: 5px 5px 0 0; margin-bottom: 5px;"></div>
                            <div style="font-size: 12px; font-weight: bold;">${data.month}</div>
                            <div style="font-size: 10px;">${(data.sales / 1000)}k</div>
                        </div>
                    `).join('')}
                </div>
            `;

            // Top contacts and overdue follow-ups
            const topContacts = contacts.slice(0, 5);
            document.getElementById('top-contacts').innerHTML = topContacts.map(contact => `
                <div style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                    <strong>${contact.firstName} ${contact.lastName}</strong>
                    <div style="font-size: 12px; color: #666;">${contact.company || contact.email}</div>
                </div>
            `).join('');

            const overdueContacts = contacts.filter(contact => {
                const lastInteraction = new Date(contact.lastInteraction || contact.dateAdded);
                const daysSince = (Date.now() - lastInteraction.getTime()) / (1000 * 60 * 60 * 24);
                return daysSince > 14 && contact.status !== 'customer';
            }).slice(0, 5);

            document.getElementById('overdue-followups').innerHTML = overdueContacts.map(contact => `
                <div style="margin: 10px 0; padding: 10px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 5px;">
                    <strong>${contact.firstName} ${contact.lastName}</strong>
                    <div style="font-size: 12px; color: #856404;">
                        ${Math.floor((Date.now() - new Date(contact.lastInteraction || contact.dateAdded).getTime()) / (1000 * 60 * 60 * 24))} days overdue
                    </div>
                </div>
            `).join('') || '<div style="text-align: center; color: #666;">All contacts up to date!</div>';
        }

        // Export and Import Functions
        function exportContacts() {
            if (contacts.length === 0) {
                showNotification('No contacts to export!', 'error');
                return;
            }
            
            const csv = convertToCSV(contacts);
            downloadCSV(csv, 'contacts.csv');
            showNotification('Contacts exported successfully!', 'success');
        }

        function exportTasks() {
            if (tasks.length === 0) {
                showNotification('No tasks to export!', 'error');
                return;
            }
            
            const tasksWithNames = tasks.map(task => {
                const contact = contacts.find(c => c.id == task.contactId);
                const deal = deals.find(d => d.id == task.dealId);
                return {
                    ...task,
                    contactName: contact ? `${contact.firstName} ${contact.lastName}` : '',
                    dealName: deal ? deal.title : ''
                };
            });
            
            const csv = convertToCSV(tasksWithNames);
            downloadCSV(csv, 'tasks.csv');
            showNotification('Tasks exported successfully!', 'success');
        }

        function exportDeals() {
            if (deals.length === 0) {
                showNotification('No deals to export!', 'error');
                return;
            }
            
            const dealsWithNames = deals.map(deal => {
                const contact = contacts.find(c => c.id == deal.contactId);
                return {
                    ...deal,
                    contactName: contact ? `${contact.firstName} ${contact.lastName}` : 'No Contact'
                };
            });
            
            const csv = convertToCSV(dealsWithNames);
            downloadCSV(csv, 'deals.csv');
            showNotification('Deals exported successfully!', 'success');
        }

        function exportAll() {
            const data = {
                contacts: contacts,
                tasks: tasks,
                deals: deals,
                meetings: meetings,
                exportDate: new Date().toISOString(),
                version: '2.0'
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `crm-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('Full backup exported successfully!', 'success');
        }

        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    if (file.name.endsWith('.json')) {
                        const data = JSON.parse(e.target.result);
                        if (data.contacts) contacts = data.contacts;
                        if (data.tasks) tasks = data.tasks;
                        if (data.deals) deals = data.deals;
                        if (data.meetings) meetings = data.meetings;
                    } else if (file.name.endsWith('.csv')) {
                        const lines = e.target.result.split('\n');
                        const headers = lines[0].split(',').map(h => h.trim());
                        
                        for (let i = 1; i < lines.length; i++) {
                            if (lines[i].trim()) {
                                const values = lines[i].split(',').map(v => v.trim());
                                const contact = {
                                    id: Date.now() + i,
                                    dateAdded: new Date().toISOString().split('T')[0],
                                    lastModified: new Date().toISOString(),
                                    lastInteraction: new Date().toISOString().split('T')[0]
                                };
                                
                                headers.forEach((header, index) => {
                                    if (values[index]) {
                                        contact[header.toLowerCase().replace(/\s+/g, '')] = values[index];
                                    }
                                });
                                
                                if (contact.email) {
                                    contacts.push(contact);
                                }
                            }
                        }
                    }
                    
                    saveData();
                    loadData();
                    showNotification('Data imported successfully!', 'success');
                } catch (error) {
                    showNotification('Error importing file! Please check the format.', 'error');
                }
            };
            reader.readAsText(file);
        }

        // Utility Functions
        function sendFollowUpEmails() {
            const overdueContacts = contacts.filter(contact => {
                const lastInteraction = new Date(contact.lastInteraction || contact.dateAdded);
                const daysSince = (Date.now() - lastInteraction.getTime()) / (1000 * 60 * 60 * 24);
                return daysSince > 14 && contact.status !== 'customer';
            });
            
            if (overdueContacts.length > 0) {
                showNotification(`Found ${overdueContacts.length} contacts needing follow-up!`, 'info');
                setTimeout(() => bulkEmailModal(overdueContacts), 1000);
            } else {
                showNotification('All contacts are up to date!', 'success');
            }
        }

        function bulkEmailModal(selectedContacts = null) {
            const modal = document.getElementById('bulk-email-modal');
            const recipients = document.getElementById('bulk-email-recipients');
            
            const contactsToShow = selectedContacts || contacts.filter(c => c.status !== 'customer');
            recipients.innerHTML = contactsToShow.map(contact => `
                <div style="margin: 5px 0;">
                    <label>
                        <input type="checkbox" checked> ${contact.firstName} ${contact.lastName} (${contact.email})
                    </label>
                </div>
            `).join('');
            
            modal.style.display = 'block';
        }

        function createBackup() {
            exportAll();
            localStorage.setItem('crmLastBackup', new Date().toISOString());
            updateLastBackupDisplay();
        }

        function restoreBackup() {
            document.getElementById('import-file').click();
        }

        function updateLastBackupDisplay() {
            const lastBackup = localStorage.getItem('crmLastBackup');
            if (lastBackup) {
                document.getElementById('last-backup').textContent = formatDate(lastBackup.split('T')[0]);
            }
        }

        function clearAllData() {
            if (confirm('Are you sure you want to delete ALL data? This cannot be undone!')) {
                if (confirm('This will permanently delete all contacts, tasks, deals, and meetings. Are you absolutely sure?')) {
                    contacts = [];
                    tasks = [];
                    deals = [];
                    meetings = [];
                    saveData();
                    loadData();
                    showNotification('All data cleared!', 'success');
                }
            }
        }

        function addEmailTemplate() {
            showNotification('Email template functionality would be implemented with a real email service!', 'info');
        }

        // Modal Functions
        function closeModal() {
            document.getElementById('contact-modal').style.display = 'none';
        }

        function closeDealModal() {
            document.getElementById('deal-modal').style.display = 'none';
        }

        function closeBulkEmailModal() {
            document.getElementById('bulk-email-modal').style.display = 'none';
        }

        // Utility Helper Functions
        function convertToCSV(data) {
            if (data.length === 0) return '';
            
            const headers = Object.keys(data[0]);
            const csvRows = [headers.join(',')];
            
            for (const row of data) {
                const values = headers.map(header => {
                    const value = row[header];
                    return typeof value === 'string' && value.includes(',') ? `"${value}"` : value || '';
                });
                csvRows.push(values.join(','));
            }
            
            return csvRows.join('\n');
        }

        function downloadCSV(csv, filename) {
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString();
        }

        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        // Initialize Application
        loadData();
        updateLastBackupDisplay();

        // Event Listeners for Modal Close
        window.onclick = function(event) {
            const contactModal = document.getElementById('contact-modal');
            const dealModal = document.getElementById('deal-modal');
            const bulkEmailModal = document.getElementById('bulk-email-modal');
            
            if (event.target === contactModal) closeModal();
            else if (event.target === dealModal) closeDealModal();
            else if (event.target === bulkEmailModal) closeBulkEmailModal();
        }
    </script>

    <footer style="
      background: linear-gradient(90deg, #9CAF88 0%, #6B8E5A 50%, #4A5D23 100%);
      color:#fff;
      text-align:center;
      padding:10px;
      margin-top:25px;
      font-size:14px;
    ">
      <div>
        <p class="text-sm">&copy; 2025 DGS Consulting â€” Streamline Today, Scale Tomorrow. All rights reserved.</p>
      </div>
      <p>
        <a href="mailto:DGSConsult@consultant.com" style="color:#fff; text-decoration:none; margin:0 8px;">Contact</a> |
        <a href="https://www.linkedin.com/company/dgs-consutling/" target="_blank" style="color:#fff; text-decoration:none; margin:0 8px;">LinkedIn</a> |
        <a href="https://www.instagram.com/dgsconsult/" target="_blank" style="color:#fff; text-decoration:none; margin:0 8px;">Instagram</a>
      </p>
    </footer>
</body>
</html>        // Calendar Functions
        function displayCalendar() {
            const calendarGrid = document.getElementById('calendar-grid');
            const monthYear = document.getElementById('calendar-month-year');
            
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            monthYear.textContent = `${currentDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}`;
            
            const daysOfWeek = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            let calendarHTML = daysOfWeek.map(day => `<div style="background: #9CAF88; color: white; padding: 10px; text-align: center; font-weight: bold;">${day}</div>`).join('');
            
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date();
            
            const prevMonth = new Date(year, month, 0);
            for (let i = firstDay - 1; i >= 0; i--) {
                const day = prevMonth.getDate() - i;
                calendarHTML += `<div class="calendar-day other-month">${day}</div>`;
            }
            
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const isToday = date.toDateString() === today.toDateString();
                const dayMeetings = meetings.filter(m => m.date === date.toISOString().split('T')[0]);
                const dayTasks = tasks.filter(t => t.dueDate === date.toISOString().split('T')[0]);
                
                calendarHTML += `
                    <div class="calendar-day ${isToday ? 'today' : ''}" onclick="selectDate('${date.toISOString().split('T')[0]}')">
                        <div>${day}</div>
                        ${dayMeetings.map(m => `<div class="calendar-event" style="background: #667eea;">${m.title}</div>`).join('')}
                        ${dayTasks.filter(t => t.status === 'pending').map(t => `<div class="calendar-event" style="background: #f39c12;">${t.title}</div>`).join('')}
                    </div>
                `;
            }
            
            const totalCells = Math.ceil((firstDay + daysInMonth) / 7) * 7;
            const remainingCells = totalCells - (firstDay + daysInMonth);
            for (let day = 1; day <= remainingCells; day++) {
                calendarHTML += `<div class="calendar-day other-month">${day}</div>`;
            }
            
            calendarGrid.innerHTML = calendarHTML;
        }

        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            displayCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            displayCalendar();
        }

        function selectDate(dateString) {
            document.getElementById('meeting-date').value = dateString;
            document.getElementById('task-due').value = dateString;
            showNotification(`Selected date: ${formatDate(dateString)}`, 'info');
        }

        // Dashboard and Analytics Functions
        function updateDashboard() {
            document.getElementById('total-contacts').textContent = contacts.length;
            document.getElementById('total-leads').textContent = contacts.filter(c => c.status === 'lead').length;
            document.getElementById('total-customers').textContent = contacts.filter(c => c.status === 'customer').length;
            document.getElementById('total-tasks').textContent = tasks.filter(t => t.status === 'pending').length;
            document.getElementById('total-deals').textContent = deals.filter(d => !['closed-won', 'closed-lost'].includes(d.stage)).length;
            
            const totalPipelineValue = deals.filter(d => !['closed-won', 'closed-lost'].includes(d.stage))
                .reduce((sum, deal) => sum + deal.value, 0);
            document.getElementById('total-deal-value').textContent = `${totalPipelineValue.toLocaleString()}`;
            
            updateRecentActivity();
        }

        function updateRecentActivity() {
            const recentContacts = contacts
                .sort((a, b) => new Date(b.lastModified || b.dateAdded) - new Date(a.lastModified || a.dateAdded))
                .slice(0, 5);
                
            const recentTasks = tasks
                .sort((a, b) => new Date(b.dateCreated) - new Date(a.dateCreated))
                .slice(0, 5);

            const recentDeals = deals
                .sort((a, b) => new Date(b.lastModified || b.dateCreated) - new Date(a.lastModified || a.dateCreated))
                .slice(0, 3);

            const activity = document.getElementById('recent-activity');
            activity.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                    <div>
                        <h4>Recent Contacts</h4>
                        ${recentContacts.map(contact => `
                            <div class="note-item">
                                <strong>${contact.firstName} ${contact.lastName}</strong>
                                <div class="note-meta">${contact.company || ''} - ${formatDate(contact.dateAdded)}</div>
                            </div>
                        `).join('')}
                    </div>
                    <div>
                        <h4>Recent Tasks</h4>
                        ${recentTasks.map(task => `
                            <div class="note-item">
                                <strong>${task.title}</strong>
                                <div class="note-meta">${task.status.toUpperCase()} - ${formatDate(task.dateCreated.split('T')[0])}</div>
                            </div>
                        `).join('')}
                    </div>
                    <div>
                        <h4>Recent Deals</h4>
                        ${recentDeals.map(deal => `
                            <div class="note-item">
                                <strong>${deal.title}</strong>
                                <div class="note-meta">${deal.value.toLocaleString()} - ${deal.stage.replace('-', ' ')}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // Filter and Sort Functions
        function filterAndSortContacts() {
            let filtered = [...contacts];
            
            const searchTerm = document.getElementById('search-contacts').value.toLowerCase();
            if (searchTerm) {
                filtered = filtered.filter(contact =>
                    contact.firstName.toLowerCase().includes(searchTerm) ||
                    contact.lastName.toLowerCase().includes(searchTerm) ||
                    contact.email.toLowerCase().includes(searchTerm) ||
                    (contact.company && contact.company.toLowerCase().includes(searchTerm)) ||
                    (contact.position && contact.position.toLowerCase().includes(searchTerm)) ||
                    (contact.tags && contact.tags.toLowerCase().includes(searchTerm))
                );
            }
            
            const statusFilter = document.getElementById('status-filter').value;
            if (statusFilter) {
                filtered = filtered.filter(contact => contact.status === statusFilter);
            }
            
            const sortBy = document.getElementById('sort-contacts').value;
            filtered.sort((a, b) => {
                switch (sortBy) {
                    case 'name':
                        return `${a.firstName} ${a.lastName}`.localeCompare(`${b.firstName} ${b.lastName}`);
                    case 'company':
                        return (a.company || '').localeCompare(b.company || '');
                    case 'date':
                        return new Date(b.dateAdded) - new Date(a.dateAdded);
                    case 'status':
                        return a.status.localeCompare(b.status);
                    case 'last-interaction':
                        return new Date(b.lastInteraction || b.dateAdded) - new Date(a.lastInteraction || a.dateAdded);
                    default:
                        return 0;
                }
            });
            
            return filtered;
        }

        function getFilteredTasks() {
            const filter = document.getElementById('task-filter').value;
            let filtered = [...tasks];
            const today = new Date().toISOString().split('T')[0];
            
            switch (filter) {
                case 'pending':
                    filtered = filtered.filter(t => t.status === 'pending');
                    break;
                case 'completed':
                    filtered = filtered.filter(t => t.status === 'completed');
                    break;
                case 'overdue':
                    filtered = filtered.filter(t => 
                        t.status === 'pending' && 
                        t.dueDate && 
                        t.dueDate < today
                    );
                    break;
                case 'today':
                    filtered = filtered.filter(t => t.dueDate === today);
                    break;
            }
            
            filtered.sort((a, b) => {
                if (a.dueDate && b.dueDate) {
                    return new Date(a.dueDate) - new Date(b.dueDate);
                }
                if (a.dueDate) return -1;
                if (b.dueDate) return 1;
                
                const priorityOrder = { high: 3, medium: 2, low: 1 };
                return priorityOrder[b.priority] - priorityOrder[a.priority];
            });
            
            return filtered;
        }

        function getFilteredDeals() {
            const filter = document.getElementById('deal-filter')?.value || 'all';
            let filtered = [...deals];
            const oneWeekFromNow = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
            
            switch (filter) {
                case 'active':
                    filtered = filtered.filter(d => !['closed-won', 'closed-lost'].includes(d.stage));
                    break;
                case 'won':
                    filtered = filtered.filter(d => d.stage === 'closed-won');
                    break;
                case 'lost':
                    filtered = filtered.filter(d => d.stage === 'closed-lost');
                    break;
                case 'closing-soon':
                    filtered = filtered.filter(d => 
                        d.closeDate && 
                        d.closeDate <= oneWeekFromNow &&
                        !['closed-won', 'closed-lost'].includes(d.stage)
                    );
                    break;
            }
            
            const sortBy = document.getElementById('sort-deals')?.value || 'value';
            filtered.sort((a, b) => {
                switch (sortBy) {
                    case 'value':
                        return b.value - a.value;
                    case 'close-date':
                        return new Date(a.closeDate || '9999-12-31') - new Date(b.closeDate || '9999-12-31');
                    case 'stage':
                        return a.stage.localeCompare(b.stage);
                    case 'probability':
                        return b.probability - a.probability;
                    default:
                        return 0;
                }
            });
            
            return filtered;
        }

        // CRUD Operations
        function viewContact(id) {
            const contact = contacts.find(c => c.id === id);
            if (!contact) return;

            const contactTasks = tasks.filter(t => t.contactId == id);
            const contactDeals = deals.filter(d => d.contactId == id);
            
            document.getElementById('modal-content').innerHTML = `
                <h2>${contact.firstName} ${contact.lastName}</h2>
                <div style="margin: 20px 0;">
                    <div class="contact-info"><strong>Email:</strong> ${contact.email}</div>
                    ${contact.phone ? `<div class="contact-info"><strong>Phone:</strong> ${contact.phone}</div>` : ''}
                    ${contact.linkedin ? `<div class="contact-info"><strong>LinkedIn:</strong> <a href="${contact.linkedin}" target="_blank">View Profile</a></div>` : ''}
                    ${contact.company ? `<div class="contact-info"><strong>Company:</strong> ${contact.company}</div>` : ''}
                    ${contact.position ? `<div class="contact-info"><strong>Position:</strong> ${contact.position}</div>` : ''}
                    <div class="contact-info"><strong>Status:</strong> ${contact.status.charAt(0).toUpperCase() + contact.status.slice(1)}</div>
                    ${contact.source ? `<div class="contact-info"><strong>Source:</strong> ${contact.source.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())}</div>` : ''}
                    ${contact.tags ? `<div class="contact-info"><strong>Tags:</strong> ${contact.tags}</div>` : ''}
                    <div class="contact-info"><strong>Date Added:</strong> ${formatDate(contact.dateAdded)}</div>
                </div>
                
                ${contact.notes ? `
                    <div class="notes-section">
                        <h4>Notes</h4>
                        <p>${contact.notes}</p>
                    </div>
                ` : ''}
                
                ${contactDeals.length > 0 ? `
                    <div class="notes-section">
                        <h4>Related Deals (${contactDeals.length})</h4>
                        ${contactDeals.map(deal => `
                            <div class="note-item">
                                <div class="note-meta">${deal.stage.toUpperCase()} - ${deal.value.toLocaleString()}</div>
                                <strong>${deal.title}</strong>
                            </div>
                        `).join('')}
                    </div>
                ` : ''}
                
                ${contactTasks.length > 0 ? `
                    <div class="notes-section">
                        <h4>Related Tasks (${contactTasks.length})</h4>
                        ${contactTasks.map(task => `
                            <div class="note-item">
                                <div class="note-meta">${task.status.toUpperCase()} - ${task.priority.toUpperCase()}</div>
                                <strong>${task.title}</strong>
                            </div>
                        `).join('')}
                    </div>
                ` : ''}
                
                <div style="margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="editContact(${id}); closeModal()">Edit Contact</button>
                    <button class="btn btn-success" onclick="createTaskFromContact(${id}); closeModal()">Create Task</button>
                    <button class="btn btn-warning" onclick="createDealFromContact(${id}); closeModal()">Create Deal</button>
                </div>
            `;
            
            document.getElementById('contact-modal').style.display = 'block';
        }

        function editContact(id) {
            const contact = contacts.find(c => c.id === id);
            if (!contact) return;

            document.getElementById('firstName').value = contact.firstName || '';
            document.getElementById('lastName').value = contact.lastName || '';
            document.getElementById('email').value = contact.email || '';
            document.getElementById('phone').value = contact.phone || '';
            document.getElementById('linkedin').value = contact.linkedin || '';
            document.getElementById('company').value = contact.company || '';
            document.getElementById('position').value = contact.position || '';
            document.getElementById('status').value = contact.status || 'lead';
            document.getElementById('source').value = contact.source || '';
            document.getElementById('tags').value = contact.tags || '';
            document.getElementById('notes').value = contact.notes || '';

            editingContactId = id;
            document.querySelector('#contact-form button[type="submit"]').textContent = "Update Contact";
            showTab('add-contact');
        }

        function deleteContact(id) {
            if (confirm('Are you sure you want to delete this contact? This will also delete related tasks and deals.')) {
                contacts = contacts.filter(contact => contact.id !== id);
                tasks = tasks.filter(task => task.contactId != id);
                deals = deals.filter(deal => deal.contactId != id);
                meetings = meetings.filter(meeting => meeting.contactId != id);
                saveData();
                updateDashboard();
                displayContacts();
                displayTasks();
                displayDeals();
                showNotification('Contact deleted successfully!', 'success');
            }
        }

        function editDeal(id) {
            const deal = deals.find(d => d.id === id);
            if (!deal) return;

            document.getElementById('deal-title').value = deal.title;
            document.getElementById('deal-contact').value = deal.contactId || '';
            document.getElementById('deal-value').value = deal.value;
            document.getElementById('deal-stage').value = deal.stage;
            document.getElementById('deal-probability').value = deal.probability;
            document.getElementById('deal-close-date').value = deal.closeDate || '';
            document.getElementById('deal-description').value = deal.description || '';

            editingDealId = id;
            showTab('deals');
        }

        function deleteDeal(id) {
            if (confirm('Are you sure you want to delete this deal?')) {
                deals = deals.filter(deal => deal.id !== id);
                tasks = tasks.filter(task => task.dealId != id);
                saveData();
                updateDashboard();
                displayDeals();
                displayTasks();
                showNotification('Deal deleted successfully!', 'success');
            }
        }

        function viewDeal(id) {
            const deal = deals.find(d => d.id === id);
            if (!deal) return;

            const contact = contacts.find(c => c.id == deal.contactId);
            
            document.getElementById('deal-modal-content').innerHTML = `
                <h2>${deal.title}</h2>
                <div style="margin: 20px 0;">
                    <div class="deal-stage stage-${deal.stage}">${deal.stage.replace('-', ' ').toUpperCase()}</div>
                    <div style="margin-top: 15px;">
                        <div><strong>Value:</strong> ${deal.value.toLocaleString()}</div>
                        <div><strong>Probability:</strong> ${deal.probability}%</div>
                        ${contact ? `<div><strong>Contact:</strong> ${contact.firstName} ${contact.lastName}</div>` : ''}
                        ${deal.closeDate ? `<div><strong>Expected Close:</strong> ${formatDate(deal.closeDate)}</div>` : ''}
                    </div>
                </div>
                
                ${deal.description ? `
                    <div class="notes-section">
                        <h4>Description</h4>
                        <p>${deal.description}</p>
                    </div>
                ` : ''}
                
                <div style="margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="editDeal(${id}); closeDealModal()">Edit Deal</button>
                    <button class="btn btn-success" onclick="createTaskFromDeal(${id}); closeDealModal()">Add Task</button>
                </div>
            `;
            
            document.getElementById('deal-modal').style.display = 'block';
        }

        // Task CRUD Operations
        function editTask(id) {
            const task = tasks.find(t => t.id === id);
            if (!task) return;

            document.getElementById('task-title').value = task.title;
            document.getElementById('task-description').value = task.description || '';
            document.getElementById('task-contact').value = task.contactId || '';
            document.getElementById('task-deal').value = task.dealId || '';
            document.getElementById('task-type').value = task.type || 'other';
            document.getElementById('task-priority').value = task.priority;
            document.getElementById('task-due').value = task.dueDate || '';

            editingTaskId = id;
            showTab('tasks');
        }

        function deleteTask(id) {
            if (confirm('Are you sure you want to delete this task?')) {
                tasks = tasks.filter(task => task.id !== id);
                saveData();
                updateDashboard();
                displayTasks();
                showNotification('Task deleted successfully!', 'success');
            }
        }

        function completeTask(id) {
            const task = tasks.find(t => t.id === id);
            if (task) {
                task.status = 'completed';
                task.dateCompleted = new Date().toISOString();
                saveData();
                updateDashboard();
                displayTasks();
                showNotification('Task completed!', 'success');
            }
        }

        function reopenTask(id) {
            const task = tasks.find(t => t.id === id);
            if (task) {
                task.status = 'pending';
                task.dateCompleted = null;
                saveData();
                updateDashboard();
                displayTasks();
                showNotification('Task reopened!', 'success');
            }
        }

        // Helper Functions
        function createTaskFromDeal(dealId) {
            document.getElementById('task-deal').value = dealId;
            const deal = deals.find(d => d.id === dealId);
            if (deal) {
                document.getElementById('task-contact').value = deal.contactId || '';
                document.getElementById('task-title').value = `Follow up on ${deal.title}`;
            }
            showTab('tasks');
        }

        function createTaskFromContact(contactId) {
            document.getElementById('task-contact').value = contactId;
            showTab('tasks');
            document.getElementById('task-title').focus();
        }

        function createDealFromContact(contactId) {
            document.getElementById('deal-contact').value = contactId;
            showTab('deals');
            document.getElementById('deal-title').focus();
        }

        // Update Option Functions
        function updateTaskContactOptions() {
            const select = document.getElementById('task-contact');
            select.innerHTML = '<option value="">Select Contact</option>' +
                contacts.map(contact => 
                    `<option value="${contact.id}">${contact.firstName} ${contact.lastName} - ${contact.company || contact.email}</option>`
                ).join('');
        }

        function updateDealContactOptions() {
            const select = document.getElementById('deal-contact');
            select.innerHTML = '<option value="">Select Contact</option>' +
                contacts.map(contact => 
                    `<option value="${contact.id}">${contact.firstName} ${contact.lastName} - ${contact.company || contact.email}</option>`
                ).join('');
        }

        function updateMeetingContactOptions() {
            const select = document.getElementById('meeting-contact');
            select.innerHTML = '<option value="">Select Contact</option>' +
                contacts.map(contact => 
                    `<option value="${contact.id}">${contact.firstName} ${contact.lastName} - ${contact.company || contact.email}</option>`
                ).join('');
        }

        function updateTaskDealOptions() {
            const select = document.getElementById('task-deal');
            select.innerHTML = '<option value="">Select Deal</option>' +
                deals.filter(d => !['closed-won', 'closed-lost'].includes(d.stage))
                .map(deal => 
                    `<option value="${deal.id}">${deal.title} - ${deal.value.toLocaleString()}</option>`
                ).join('');
        }<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="images/logo-icon-t.png" />
    <title>Enhanced CRM System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #9CAF88 0%, #6B8E5A 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 5px;
            backdrop-filter: blur(10px);
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            border-radius: 10px;
            margin: 0 5px;
            transition: all 0.3s ease;
            font-size: 16px;
            font-weight: 500;
        }

        .nav-tab.active {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .tab-content {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-section {
            background: linear-gradient(135deg, #9CAF88 0%, #9CAF88 100%);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 5px solid #4A5D23;
        }

        .form-section h3 {
            color: #ffffff;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #ffffff;
        }

        .form-group input, 
        .form-group select, 
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ffffff;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }

        .btn {
            background: linear-gradient(135deg, #9CAF88 0%, #6B8E5A 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #fd79a8 0%, #e84393 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #55efc4 0%, #00b894 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #fdcb6e 0%, #e17055 100%);
        }

        .contacts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .contact-card {
            background: linear-gradient(135deg, #9CAF88 0%, #6B8E5A 100%);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-left: 5px solid #4A5D23;
            position: relative;
            transition: all 0.3s ease;
        }

        .contact-card:hover {
            transform: translateY(-5px);
        }

        .contact-card h4 {
            color: #ffffff;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .contact-info {
            color: #ffffff;
            margin-bottom: 8px;
        }

        .contact-info strong {
            color: #ffffff;
            margin-right: 8px;
            min-width: 80px;
        }

        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #9CAF88 0%, #6B8E5A 100%);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            color: white;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1rem;
            opacity: 0.9;
        }

        .search-bar {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 16px;
            margin-bottom: 20px;
            background: rgba(255,255,255,0.9);
        }

        .filters-container {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-group select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
        }

        .notes-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border-left: 4px solid #9CAF88;
        }

        .note-item {
            background: white;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 3px solid #6B8E5A;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .note-meta {
            font-size: 0.8em;
            color: #666;
            margin-bottom: 5px;
        }

        .task-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #9CAF88;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .task-item.completed {
            opacity: 0.7;
            border-left-color: #00b894;
        }

        .task-content {
            flex: 1;
        }

        .task-actions {
            display: flex;
            gap: 10px;
        }

        .priority-high { border-left-color: #e74c3c !important; }
        .priority-medium { border-left-color: #f39c12 !important; }
        .priority-low { border-left-color: #2ecc71 !important; }

        .export-import-section {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #9CAF88 0%, #6B8E5A 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 1001;
            display: none;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        /* Deal specific styles */
        .deal-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            color: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .deal-stage {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stage-lead { background: #ff6b6b; }
        .stage-qualified { background: #4ecdc4; }
        .stage-proposal { background: #45b7d1; }
        .stage-negotiation { background: #f9ca24; color: #333; }
        .stage-closed-won { background: #6c5ce7; }
        .stage-closed-lost { background: #a0a0a0; }

        /* Calendar styles */
        .calendar-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #ddd;
            border-radius: 10px;
            overflow: hidden;
        }

        .calendar-day {
            background: white;
            padding: 10px;
            min-height: 80px;
            position: relative;
            cursor: pointer;
        }

        .calendar-day.other-month {
            background: #f8f9fa;
            color: #ccc;
        }

        .calendar-day.today {
            background: #9CAF88;
            color: white;
        }

        .calendar-event {
            background: #667eea;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 11px;
            margin-top: 2px;
            cursor: pointer;
        }

        /* Reports styles */
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #9CAF88 0%, #6B8E5A 100%);
            transition: width 0.3s ease;
        }

        /* Email template styles */
        .email-template {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #9CAF88;
        }

        .template-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        /* DARK MODE STYLES */
        body.dark-mode {
            background: linear-gradient(135deg, #1e1e2f 0%, #2c2c3e 100%);
            color: #f5f5f5;
        }

        body.dark-mode .tab-content {
            background: #2c2c3e;
            color: #fff;
            border-color: #444;
        }

        body.dark-mode .contact-card {
            background: #3a3a4e;
            color: #fff;
            border-left-color: #764ba2;
        }

        body.dark-mode .stat-card {
            background: #3a3a4e;
            color: #fff;
        }

        body.dark-mode .search-bar {
            background: #2c2c3e;
            color: #fff;
            border-color: #555;
        }

        body.dark-mode .form-group input,
        body.dark-mode .form-group select,
        body.dark-mode .form-group textarea {
            background: #2c2c3e;
            color: #fff;
            border-color: #555;
        }

        body.dark-mode .modal-content {
            background: #2c2c3e;
            color: #fff;
        }

        body.dark-mode .task-item,
        body.dark-mode .note-item {
            background: #3a3a4e;
            color: #fff;
        }

        body.dark-mode .notes-section {
            background: #3a3a4e;
        }

        body.dark-mode .calendar-container,
        body.dark-mode .chart-container {
            background: #2c2c3e;
            color: #fff;
        }

        body.dark-mode .calendar-day {
            background: #3a3a4e;
            color: #fff;
        }

        body.dark-mode .calendar-day.other-month {
            background: #2c2c3e;
            color: #666;
        }

        @media (max-width: 768px) {
            .nav-tabs {
                flex-direction: column;
                gap: 5px;
            }
            
            .nav-tab {
                margin: 2px 0;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .contacts-grid {
                grid-template-columns: 1fr;
            }
            
            .export-import-section {
                flex-direction: column;
            }

            .calendar-grid {
                grid-template-columns: repeat(7, 1fr);
                gap: 1px;
            }

            .calendar-day {
                min-height: 60px;
                padding: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸš€ Enhanced CRM System</h1>
            <p>Manage your contacts, deals, tasks, and business growth efficiently</p>
            <button onclick="toggleDarkMode()" class="btn btn-secondary" style="margin-top: 15px;">
                ðŸŒ™ Toggle Dark Mode
            </button>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('dashboard')">ðŸ“Š Dashboard</button>
            <button class="nav-tab" onclick="showTab('contacts')">ðŸ‘¥ Contacts</button>
            <button class="nav-tab" onclick="showTab('add-contact')">âž• Add Contact</button>
            <button class="nav-tab" onclick="showTab('tasks')">ðŸ“‹ Tasks</button>
            <button class="nav-tab" onclick="showTab('deals')">ðŸ’° Deals</button>
            <button class="nav-tab" onclick="showTab('calendar')">ðŸ“… Calendar</button>
            <button class="nav-tab" onclick="showTab('analytics')">ðŸ“ˆ Analytics</button>
            <button class="nav-tab" onclick="showTab('reports')">ðŸ“Š Reports</button>
            <button class="nav-tab" onclick="showTab('import-export')">ðŸ’¾ Data</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="dashboard-stats">
                <div class="stat-card">
                    <div class="stat-number" id="total-contacts">0</div>
                    <div class="stat-label">Total Contacts</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-leads">0</div>
                    <div class="stat-label">Active Leads</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-customers">0</div>
                    <div class="stat-label">Customers</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-tasks">0</div>
                    <div class="stat-label">Pending Tasks</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-deals">0</div>
                    <div class="stat-label">Active Deals</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-deal-value">$0</div>
                    <div class="stat-label">Pipeline Value</div>
                </div>
            </div>
            
            <div class="form-section">
                <h3>ðŸ“Š Recent Activity</h3>
                <div id="recent-activity"></div>
            </div>

            <div class="form-section">
                <h3>âš¡ Quick Actions</h3>
                <div class="export-import-section">
                    <button class="btn" onclick="showTab('add-contact')">ðŸ‘¤ Add Contact</button>
                    <button class="btn btn-secondary" onclick="showTab('tasks')">ðŸ“‹ Add Task</button>
                    <button class="btn btn-success" onclick="showTab('deals')">ðŸ’° Create Deal</button>
                    <button class="btn btn-warning" onclick="sendFollowUpEmails()">ðŸ“§ Send Follow-ups</button>
                </div>
            </div>
        </div>

        <!-- Contacts Tab -->
        <div id="contacts" class="tab-content">
            <input type="text" class="search-bar" id="search-contacts" placeholder="ðŸ” Search contacts..." oninput="filterContacts()">
            
            <div class="filters-container">
                <div class="filter-group">
                    <label>Status Filter:</label>
                    <select id="status-filter" onchange="filterContacts()">
                        <option value="">All Statuses</option>
                        <option value="lead">Lead</option>
                        <option value="prospect">Prospect</option>
                        <option value="customer">Customer</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Sort By:</label>
                    <select id="sort-contacts" onchange="sortContacts()">
                        <option value="name">Name</option>
                        <option value="company">Company</option>
                        <option value="date">Date Added</option>
                        <option value="status">Status</option>
                        <option value="last-interaction">Last Interaction</option>
                    </select>
                </div>
                <button class="btn btn-secondary" onclick="exportContacts()">ðŸ“¤ Export CSV</button>
                <button class="btn btn-success" onclick="bulkEmailModal()">ðŸ“§ Bulk Email</button>
            </div>
            
            <div class="contacts-grid" id="contacts-grid"></div>
        </div>

        <!-- Add Contact Tab -->
        <div id="add-contact" class="tab-content">
            <div class="form-section">
                <h3>ðŸ‘¤ Contact Information</h3>
                <form id="contact-form">
                    <div class="form-grid">
                        <div>
                            <div class="form-group">
                                <label for="firstName">First Name *</label>
                                <input type="text" id="firstName" required>
                            </div>
                            <div class="form-group">
                                <label for="lastName">Last Name *</label>
                                <input type="text" id="lastName" required>
                            </div>
                            <div class="form-group">
                                <label for="email">Email *</label>
                                <input type="email" id="email" required>
                            </div>
                            <div class="form-group">
                                <label for="phone">Phone</label>
                                <input type="tel" id="phone">
                            </div>
                            <div class="form-group">
                                <label for="linkedin">LinkedIn URL</label>
                                <input type="url" id="linkedin" placeholder="https://linkedin.com/in/username">
                            </div>
                        </div>
                        <div>
                            <div class="form-group">
                                <label for="company">Company</label>
                                <input type="text" id="company">
                            </div>
                            <div class="form-group">
                                <label for="position">Position</label>
                                <input type="text" id="position">
                            </div>
                            <div class="form-group">
                                <label for="status">Status *</label>
                                <select id="status" required>
                                    <option value="lead">Lead</option>
                                    <option value="prospect">Prospect</option>
                                    <option value="customer">Customer</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="source">Lead Source</label>
                                <select id="source">
                                    <option value="">Select Source</option>
                                    <option value="website">Website</option>
                                    <option value="referral">Referral</option>
                                    <option value="social-media">Social Media</option>
                                    <option value="advertisement">Advertisement</option>
                                    <option value="event">Event</option>
                                    <option value="cold-outreach">Cold Outreach</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="tags">Tags (comma-separated)</label>
                                <input type="text" id="tags" placeholder="VIP, decision-maker, hot-lead">
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="notes">Notes</label>
                        <textarea id="notes" rows="3" placeholder="Add notes about this contact..."></textarea>
                    </div>
                    <button type="submit" class="btn">ðŸ’¾ Save Contact</button>
                    <button type="reset" class="btn btn-secondary">ðŸ”„ Reset Form</button>
                </form>
            </div>
        </div>

        <!-- Tasks Tab -->
        <div id="tasks" class="tab-content">
            <div class="form-section">
                <h3>âž• Add New Task</h3>
                <form id="task-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="task-title">Task Title *</label>
                            <input type="text" id="task-title" required>
                        </div>
                        <div class="form-group">
                            <label for="task-contact">Related Contact</label>
                            <select id="task-contact">
                                <option value="">Select Contact</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="task-deal">Related Deal</label>
                            <select id="task-deal">
                                <option value="">Select Deal</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="task-type">Task Type</label>
                            <select id="task-type">
                                <option value="call">Call</option>
                                <option value="email">Email</option>
                                <option value="meeting">Meeting</option>
                                <option value="follow-up">Follow-up</option>
                                <option value="proposal">Proposal</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="task-priority">Priority</label>
                            <select id="task-priority">
                                <option value="low">Low</option>
                                <option value="medium" selected>Medium</option>
                                <option value="high">High</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="task-due">Due Date</label>
                            <input type="date" id="task-due">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="task-description">Description</label>
                        <textarea id="task-description" rows="3"></textarea>
                    </div>
                    <button type="submit" class="btn">âž• Add Task</button>
                </form>
            </div>

            <div class="filters-container">
                <div class="filter-group">
                    <label>Filter Tasks:</label>
                    <select id="task-filter" onchange="filterTasks()">
                        <option value="all">All Tasks</option>
                        <option value="pending">Pending</option>
                        <option value="completed">Completed</option>
                        <option value="overdue">Overdue</option>
                        <option value="today">Due Today</option>
                    </select>
                </div>
            </div>

            <div id="tasks-list"></div>
        </div>

        <!-- Deals Tab -->
        <div id="deals" class="tab-content">
            <div class="form-section">
                <h3>ðŸ’° Add New Deal</h3>
                <form id="deal-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="deal-title">Deal Title *</label>
                            <input type="text" id="deal-title" required>
                        </div>
                        <div class="form-group">
                            <label for="deal-contact">Primary Contact *</label>
                            <select id="deal-contact" required>
                                <option value="">Select Contact</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="deal-value">Deal Value ($)</label>
                            <input type="number" id="deal-value" step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label for="deal-stage">Stage *</label>
                            <select id="deal-stage" required>
                                <option value="lead">Lead</option>
                                <option value="qualified">Qualified</option>
                                <option value="proposal">Proposal</option>
                                <option value="negotiation">Negotiation</option>
                                <option value="closed-won">Closed Won</option>
                                <option value="closed-lost">Closed Lost</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="deal-probability">Probability (%)</label>
                            <input type="number" id="deal-probability" min="0" max="100" value="50">
                        </div>
                        <div class="form-group">
                            <label for="deal-close-date">Expected Close Date</label>
                            <input type="date" id="deal-close-date">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="deal-description">Description</label>
                        <textarea id="deal-description" rows="3" placeholder="Describe the deal, requirements, etc."></textarea>
                    </div>
                    <button type="submit" class="btn">ðŸ’° Save Deal</button>
                    <button type="reset" class="btn btn-secondary">ðŸ”„ Reset Form</button>
                </form>
            </div>

            <div class="filters-container">
                <div class="filter-group">
                    <label>Filter Deals:</label>
                    <select id="deal-filter" onchange="filterDeals()">
                        <option value="all">All Deals</option>
                        <option value="active">Active Deals</option>
                        <option value="won">Won</option>
                        <option value="lost">Lost</option>
                        <option value="closing-soon">Closing Soon</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Sort By:</label>
                    <select id="sort-deals" onchange="sortDeals()">
                        <option value="value">Deal Value</option>
                        <option value="close-date">Close Date</option>
                        <option value="stage">Stage</option>
                        <option value="probability">Probability</option>
                    </select>
                </div>
            </div>

            <div id="deals-list"></div>
        </div>

        <!-- Calendar Tab -->
        <div id="calendar" class="tab-content">
            <div class="calendar-container">
                <div class="calendar-header">
                    <button class="btn btn-secondary" onclick="previousMonth()">â—€ Previous</button>
                    <h3 id="calendar-month-year"></h3>
                    <button class="btn btn-secondary" onclick="nextMonth()">Next â–¶</button>
                </div>
                <div class="calendar-grid" id="calendar-grid">
                    <!-- Calendar days will be generated here -->
                </div>
            </div>

            <div class="form-section" style="margin-top: 30px;">
                <h3>ðŸ“… Schedule Meeting</h3>
                <form id="meeting-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="meeting-title">Meeting Title *</label>
                            <input type="text" id="meeting-title" required>
                        </div>
                        <div class="form-group">
                            <label for="meeting-contact">Contact</label>
                            <select id="meeting-contact">
                                <option value="">Select Contact</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="meeting-date">Date *</label>
                            <input type="date" id="meeting-date" required>
                        </div>
                        <div class="form-group">
                            <label for="meeting-time">Time *</label>
                            <input type="time" id="meeting-time" required>
                        </div>
                        <div class="form-group">
                            <label for="meeting-duration">Duration (minutes)</label>
                            <select id="meeting-duration">
                                <option value="30">30 minutes</option>
                                <option value="60" selected>1 hour</option>
                                <option value="90">1.5 hours</option>
                                <option value="120">2 hours</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="meeting-location">Location/Link</label>
                            <input type="text" id="meeting-location" placeholder="Office, Zoom link, etc.">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="meeting-description">Description/Agenda</label>
                        <textarea id="meeting-description" rows="3"></textarea>
                    </div>
                    <button type="submit" class="btn">ðŸ“… Schedule Meeting</button>
                </form>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics" class="tab-content">
            <div class="dashboard-stats">
                <div class="stat-card">
                    <div class="stat-number" id="conversion-rate">0%</div>
                    <div class="stat-label">Lead Conversion Rate</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="avg-deal-value">$0</div>
                    <div class="stat-label">Avg. Deal Value</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="active-opportunities">0</div>
                    <div class="stat-label">Active Opportunities</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="monthly-growth">0%</div>
                    <div class="stat-label">Monthly Growth</div>
                </div>
            </div>

            <div class="form-section">
                <h3>ðŸ“ˆ Contact Distribution by Status</h3>
                <div id="status-chart"></div>
            </div>

            <div class="form-section">
                <h3>ðŸ“Š Lead Sources</h3>
                <div id="source-chart"></div>
            </div>

            <div class="form-section">
                <h3>ðŸ’° Deal Pipeline</h3>
                <div id="pipeline-chart"></div>
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reports" class="tab-content">
            <div class="form-section">
                <h3>ðŸ“Š Sales Performance</h3>
                <div class="chart-container">
                    <h4>Monthly Sales Trends</h4>
                    <div id="sales-trend-chart"></div>
                </div>
            </div>

            <div class="form-section">
                <h3>ðŸŽ¯ Goal Tracking</h3>
                <div class="chart-container">
                    <div class="form-grid">
                        <div>
                            <h4>Monthly Contact Goal</h4>
                            <div class="progress-bar">
                                <div class="progress-fill" id="contact-progress" style="width: 65%"></div>
                            </div>
                            <p>65/100 contacts this month</p>
                        </div>
                        <div>
                            <h4>Revenue Goal</h4>
                            <div class="progress-bar">
                                <div class="progress-fill" id="revenue-progress" style="width: 80%"></div>
                            </div>
                            <p>$80,000/$100,000 this month</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>ðŸ“ˆ Activity Report</h3>
                <div class="chart-container">
                    <div id="activity-report"></div>
                </div>
            </div>

            <div class="form-section">
                <h3>ðŸ” Contact Insights</h3>
                <div class="chart-container">
                    <div class="form-grid">
                        <div>
                            <h4>Most Engaged Contacts</h4>
                            <div id="top-contacts"></div>
                        </div>
                        <div>
                            <h4>Overdue Follow-ups</h4>
                            <div id="overdue-followups"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Import/Export Tab -->
        <div id="import-export" class="tab-content">
            <div class="form-section">
                <h3>ðŸ“¤ Export Data</h3>
                <div class="export-import-section">
                    <button class="btn" onclick="exportContacts()">ðŸ“§ Export Contacts (CSV)</button>
                    <button class="btn btn-secondary" onclick="exportTasks()">ðŸ“‹ Export Tasks (CSV)</button>
                    <button class="btn btn-warning" onclick="exportDeals()">ðŸ’° Export Deals (CSV)</button>
                    <button class="btn btn-success" onclick="exportAll()">ðŸ’¾ Export All Data (JSON)</button>
                </div>
            </div>

            <div class="form-section">
                <h3>ðŸ“¥ Import Data</h3>
                <div class="form-group">
                    <label for="import-file">Select File (CSV or JSON)</label>
                    <input type="file" id="import-file" accept=".csv,.json" onchange="handleFileImport(event)">
                </div>
                <button class="btn btn-warning" onclick="clearAllData()">ðŸ—‘ï¸ Clear All Data</button>
            </div>

            <div class="form-section">
                <h3>ðŸ”„ Backup & Restore</h3>
                <p>Last backup: <span id="last-backup">Never</span></p>
                <div class="export-import-section">
                    <button class="btn" onclick="createBackup()">ðŸ’¾ Create Backup</button>
                    <button class="btn btn-secondary" onclick="restoreBackup()">ðŸ”„ Restore Backup</button>
                </div>
            </div>

            <div class="form-section">
                <h3>ðŸ“§ Email Templates</h3>
                <div id="email-templates">
                    <div class="email-template">
                        <h4>Follow-up Template</h4>
                        <p>Hi {firstName}, I wanted to follow up on our conversation about {topic}...</p>
                        <div class="template-actions">
                            <button class="btn btn-secondary">Edit</button>
                            <button class="btn">Use Template</button>
                        </div>
                    </div>
                    <div class="email-template">
                        <h4>Welcome Email</h4>
                        <p>Welcome to our service, {firstName}! We're excited to work with {company}...</p>
                        <div class="template-actions">
                            <button class="btn btn-secondary">Edit</button>
                            <button class="btn">Use Template</button>
                        </div>
                    </div>
                </div>
                <button class="btn btn-success" onclick="addEmailTemplate()">âž• Add New Template</button>
            </div>
        </div>
    </div>

    <!-- Contact Details Modal -->
    <div id="contact-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <div id="modal-content"></div>
        </div>
    </div>

    <!-- Deal Details Modal -->
    <div id="deal-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeDealModal()">&times;</span>
            <div id="deal-modal-content"></div>
        </div>
    </div>

    <!-- Bulk Email Modal -->
    <div id="bulk-email-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeBulkEmailModal()">&times;</span>
            <h3>ðŸ“§ Send Bulk Email</h3>
            <form id="bulk-email-form">
                <div class="form-group">
                    <label for="bulk-email-subject">Subject *</label>
                    <input type="text" id="bulk-email-subject" required>
                </div>
                <div class="form-group">
                    <label for="bulk-email-template">Template</label>
                    <select id="bulk-email-template">
                        <option value="">Select Template</option>
                        <option value="follow-up">Follow-up Template</option>
                        <option value="welcome">Welcome Email</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="bulk-email-message">Message *</label>
                    <textarea id="bulk-email-message" rows="8" required placeholder="Your email message here..."></textarea>
                </div>
                <div class="form-group">
                    <label for="bulk-email-recipients">Recipients (Selected contacts will receive this email)</label>
                    <div id="bulk-email-recipients">
                        <!-- Recipients will be populated here -->
                    </div>
                </div>
                <button type="submit" class="btn">ðŸ“§ Send Emails</button>
                <button type="button" class="btn btn-secondary" onclick="closeBulkEmailModal()">Cancel</button>
            </form>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <script>
        // Global Variables
        let contacts = [];
        let tasks = [];
        let deals = [];
        let meetings = [];
        let editingContactId = null;
        let editingTaskId = null;
        let editingDealId = null;
        let currentDate = new Date();

        // Data Management Functions
        function loadData() {
            const savedContacts = JSON.parse(localStorage.getItem('crmContacts') || '[]');
            const savedTasks = JSON.parse(localStorage.getItem('crmTasks') || '[]');
            const savedDeals = JSON.parse(localStorage.getItem('crmDeals') || '[]');
            const savedMeetings = JSON.parse(localStorage.getItem('crmMeetings') || '[]');
            
            contacts = savedContacts;
            tasks = savedTasks;
            deals = savedDeals;
            meetings = savedMeetings;
            
            const darkModeSetting = localStorage.getItem('crmDarkMode');
            if (darkModeSetting === 'enabled') {
                document.body.classList.add('dark-mode');
            }
            
            updateDashboard();
            displayContacts();
            displayTasks();
            displayDeals();
            displayCalendar();
            updateTaskContactOptions();
            updateDealContactOptions();
            updateMeetingContactOptions();
            updateAnalytics();
            updateReports();
        }

        function saveData() {
            localStorage.setItem('crmContacts', JSON.stringify(contacts));
            localStorage.setItem('crmTasks', JSON.stringify(tasks));
            localStorage.setItem('crmDeals', JSON.stringify(deals));
            localStorage.setItem('crmMeetings', JSON.stringify(meetings));
        }

        // UI Functions
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'analytics') {
                setTimeout(updateAnalytics, 100);
            } else if (tabName === 'calendar') {
                setTimeout(displayCalendar, 100);
            } else if (tabName === 'reports') {
                setTimeout(updateReports, 100);
            }
        }

        function toggleDarkMode() {
            const isDark = document.body.classList.toggle('dark-mode');
            localStorage.setItem('crmDarkMode', isDark ? 'enabled' : 'disabled');
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            
            if (type === 'error') {
                notification.style.background = 'linear-gradient(135deg, #fd79a8 0%, #e84393 100%)';
            } else if (type === 'success') {
                notification.style.background = 'linear-gradient(135deg, #55efc4 0%, #00b894 100%)';
            } else {
                notification.style.background = 'linear-gradient(135deg, #9CAF88 0%, #6B8E5A 100%)';
            }
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
